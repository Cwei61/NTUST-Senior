<% 
def star(num)
  baseline_box margin: :md do
    (0...num.to_i).each do
      icon "https://scdn.line-apps.com/n/channel_devcenter/img/fx/review_gold_star_28.png", size: :sm
    end
    (num.to_i...5).each do
      icon "https://scdn.line-apps.com/n/channel_devcenter/img/fx/review_gray_star_28.png", size: :sm
    end
    text "#{num}", size: :sm, color: "#999999", margin: :md, flex: 0
  end
end

def field(key, value)
  baseline_box spacing: :sm do
    text key, "color":"#aaaaaa","size":"sm","flex":1
    text value, "wrap":true,"color":"#666666","size":"sm","flex":5
  end
end %>
<%= raw(Kamiflex.json(self) do
  carousel do
    @places.each do |place|
      bubble do
        hero place.photo,
          size: :full, aspectRatio: "20:13", aspectMode: :cover
        body do
          text place.name, weight: :bold, size: :xl
          star(place.star)
          vertical_box margin: :lg, spacing: :sm do
            field "地點", place.address
            baseline_box spacing: :sm do
              text "時間", "color":"#aaaaaa","size":"sm","flex":1
              text place.opening_times.try(:first).try(:section), "wrap":true,"color":"#666666","size":"sm","flex":5
            end
            place.opening_times[1..].try(:each) do |time|
              baseline_box spacing: :sm do
                filler
                text time.section, "wrap":true,"color":"#666666","size":"sm","flex":5
              end
            end
          end
        end
        footer spacing: :sm, flex: 0 do
          url_button "立即前往", place.google_map_url, style: :primary, height: :sm
          spacer size: :sm
        end
      end
    end
    bubble do
      header margin: "none", backgroundColor: "#00CE39" do
        vertical_box do
          text "功能頁",gravity: "center",size: "xl",align: "center",color: "#FFFFFF"
        end
      end
      body margin: "none" do
        unless @places.first_page?
          message_button "第一頁", "美食列表/1", style: "secondary", margin: "md"
          message_button "上一頁", "美食列表/#{@places.prev_page}", style: "secondary", margin: "md"
        end
        unless @places.blank? || @places.last_page?
        message_button "下一頁", "美食列表/#{@places.next_page}", style: "secondary", margin: "md"
        message_button "最後一頁", "美食列表/#{@places.total_pages}", style: "secondary", margin: "md"
        end
        url_button "我要推薦美食", liff_path(path: new_place_path), style: "secondary", margin: "md"
      end
      footer do
       text "目前在 #{@current_page}/#{@places.total_pages} 頁", align: "center"
      end
    end
  end
end)%>